set search_path to cve;

CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
CREATE EXTENSION IF NOT EXISTS "vector";

CREATE TABLE cve_records(
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  cve_id VARCHAR(255) NOT NULL,
  record JSONB NOT NULL,
  vrsn VARCHAR(255),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  description TEXT,
  embedding VECTOR(1536)
);

CREATE INDEX cve_id_index ON cve_records(cve_id);
CREATE INDEX cve_json_index ON cve_records((record->'cveMetadata'->>'cveId'));
CREATE INDEX ON cve.cve_records USING ivfflat (embedding vector_cosine_ops);
